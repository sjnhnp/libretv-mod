<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .result {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>简单脚本测试</h1>
    
    <button onclick="runTest()">运行测试</button>
    <div id="results"></div>

    <!-- 只加载必要的脚本 -->
    <script src="js/simple_quality_detector.js"></script>

    <script>
        function runTest() {
            const resultsDiv = document.getElementById('results');
            let output = '';
            
            // 检查函数是否存在
            output += '=== 函数存在性检查 ===\n';
            output += `window.precheckSource: ${typeof window.precheckSource}\n`;
            output += `window.simplePrecheckSource: ${typeof window.simplePrecheckSource}\n`;
            output += `window.comprehensiveQualityCheck: ${typeof window.comprehensiveQualityCheck}\n`;
            output += `window.videoElementDetection: ${typeof window.videoElementDetection}\n\n`;
            
            // 如果函数存在，测试调用
            if (typeof window.precheckSource === 'function') {
                output += '=== 函数调用测试 ===\n';
                
                // 测试关键词识别
                const testUrls = [
                    'https://example.com/video_1080p.m3u8',
                    'https://example.com/video_720p_hd.m3u8',
                    'https://example.com/video_4k_uhd.m3u8',
                    'https://m3u8.heimuertv.com/play/8956f3d7c69043d59bfb34a1b5879223.m3u8'
                ];
                
                testUrls.forEach(async (url, index) => {
                    try {
                        const result = await window.precheckSource(url);
                        output += `测试 ${index + 1}: ${url}\n`;
                        output += `结果: ${result.quality} (${result.loadSpeed})\n\n`;
                        
                        if (index === testUrls.length - 1) {
                            resultsDiv.innerHTML = `<div class="result">${output}</div>`;
                        }
                    } catch (error) {
                        output += `测试 ${index + 1} 失败: ${error.message}\n\n`;
                        if (index === testUrls.length - 1) {
                            resultsDiv.innerHTML = `<div class="result">${output}</div>`;
                        }
                    }
                });
            } else {
                output += '❌ precheckSource 函数未定义\n';
                output += '可能的原因:\n';
                output += '1. 脚本文件未正确加载\n';
                output += '2. 脚本中有语法错误\n';
                output += '3. 浏览器缓存问题\n';
            }
            
            resultsDiv.innerHTML = `<div class="result">${output}</div>`;
        }
        
        // 页面加载后自动检查
        window.addEventListener('load', () => {
            setTimeout(() => {
                const resultsDiv = document.getElementById('results');
                let output = '=== 页面加载后检查 ===\n';
                output += `当前时间: ${new Date().toLocaleString()}\n`;
                output += `window.precheckSource: ${typeof window.precheckSource}\n`;
                
                if (typeof window.precheckSource === 'function') {
                    output += '✅ 检测器已正确加载\n';
                } else {
                    output += '❌ 检测器未加载\n';
                }
                
                resultsDiv.innerHTML = `<div class="result">${output}</div>`;
            }, 500);
        });
    </script>
</body>
</html>